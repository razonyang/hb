{{/* JS compile options. */}}
{{- $params := dict
  "site" .Site.Params
}}
{{- $options := dict
  "sourceMap" (cond hugo.IsProduction "" "inline")
  "minify" hugo.IsProduction
  "params" $params
  "targetPath" "js/hb.js"
}}
{{/* Get JS template. */}}
{{- $js := resources.Get "hb/js/index.tmpl.ts" | resources.ExecuteAsTemplate "hb/js/index.ts" . }}
{{/* warnf "[hb] %s:\n%s\n" $js.Name $js.Content */}}
{{/* Compile JS. */}}
{{- $js = $js | js.Build $options }}
{{- if hugo.IsProduction }}
  {{- $js = $js | fingerprint }}
{{- end }}
{{/* Precache JS. */}}
{{- partial "base/partial-if-exists" (dict
  "Name" "pwa/functions/precache.html"
  "Context" (dict "Page" . "URL" $js.RelPermalink)
  )
}}
<script
  src="{{ $js.RelPermalink }}"
  {{ if hugo.IsProduction }}integrity="{{ $js.Data.Integrity }}"{{ end }}
  defer></script>
